<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:rsf="http://ponder.org.uk/rsf" xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

   <title rsf:id="msg=assignment2.title">Assignments</title>
    <link href="/library/skin/tool_base.css" type="text/css" rel="stylesheet" media="all"/>
    <link href="/library/skin/default/tool.css" type="text/css" rel="stylesheet" media="all"/>
	<link href="/sakai-assignment2-tool/content/css/assignmentsv4.css" type="text/css" rel="stylesheet" media="all" />
</head>

<body>
<!--  everything outside of rsf:id="page:" is set in Layout.html using outerPageTemplates -->

<div rsf:id="page:" class="portletBody">
	
	<script type="text/javascript" src="/sakai-assignment2-tool/content/js/ui.core.js"></script>
	<script type="text/javascript" src="/sakai-assignment2-tool/content/js/ui.draggable.js"></script>
	<script type="text/javascript" src="/sakai-assignment2-tool/content/js/ui.sortable.js"></script>
	
	<ul class="breadCrumb">
		<li rsf:id="last_breadcrumb" class="lastCrumb">Last Breadcrumb</li>
		<li class="lastCrumb link"><a rsf:id="settings_link">Settings</a></li>
		<li class="lastCrumb link"><a rsf:id="reorder_link">Reorder</a></li>
	</ul>

	<div class="generalErrors">
		<ul rsf:id="message-for:*" style="margin:0px;">
			<li>Message for user here</li>
		</ul>
	</div>

	<br /><br />
	<ul id="assignmentList">
	  <li class="header">
	     <div class="container">
           <h3 class="left">
              <span rsf:id="msg=assignment2.list.assignments">Assignment</span>
              <a rsf:id="add_assignment" href="" class="add_assignment">Add</a> 
           </h3>
           <h3 class="right" rsf:id="msg=assignment2.list.submissions_total">
              Submissions Graded/Total
           </h3>
         </div>
	  </li>
	  <li rsf:id="assignment-row:" class="row">
		<div class="container">
			<div class="widget">
 				<form rsf:id="form" method="post" class="innerForm">
 					<!-- <a href="#TB_inline?height=155&amp;width=300&amp;inlineId=confirm-remove&amp;modal=true" class="thickbox">Delete</a> -->
					<a style="display:none" class="assignment_delete"><img src="/sakai-assignment2-tool/content/images/bin_closed.png" /></a>
					<input type="submit" rsf:id="assignment_delete" class="delete_replace" />
					<input type="hidden" rsf:id="current_assignment" />
					<a rsf:id="assignment_edit">Edit</a>
				</form>
	        </div>
           <div rsf:id="div-left-container" class="left">
              <span rsf:id="assignment_title" class="assignment_title">Assignment 1</span>
              <span rsf:id="draft" class="draft">draft</span>
              <span class="duedate"><strong rsf:id="msg=assignment2.list.due_date">DUE:</strong><span rsf:id="assignment_row_due"></span></span>
           </div>
           <div class="right">
              <a rsf:id="grade">5/8</a>
              <span rsf:id="no_submission_req">N/A</span>
           </div>
        </div>
		</li>
	</ul>
	
	<!-- This is the template for the Confirm Asnn Remove Dialog. -->
	<div id="remove-assn-dialog" style="display:none">
		<div class="generalErrors">
			<ul style="margin:0px;">
				<li id="msg=assignment2.remove.assn.confirm">Message for user here</li>
			</ul>
		</div>
		<table rsf:id="assignment-list-table" class="listHier lines">
			<tr> 
				<th rsf:id="msg=assignment2.remove.assn.header.title">Assignment Title</th>
				<th rsf:id="msg=assignment2.remove.assn.header.due">Due</th>
				<th rsf:id="msg=assignment2.remove.assn.header.submissions">Submissions</th>
			</tr>
			<tr rsf:id="asnn-row:">
				<td class="asnn-title">Homework 1</td>
				<td class="due">Mar 26, 2008 5:00 pm</td>
				<td class="submissions">1</td>
			</tr>
		</table>
		<form rsf:id="confirm-remove-form">
			<fieldset class="submit">
				<input accesskey="r" type="submit" class="remove-button active" value="Post" />
				<input class="cancel-button" accesskey="x" type="submit" value="Cancel" />
			</fieldset>
		</form>
	</div>
	
	<script rsf:id="init_ajaxCallbackURL" type="text/javascript">
	//ajaxCallbackURL - set via producer
	</script>
	
	<script type="text/javascript">
	//<![CDATA[
	 jQuery("#assignmentList").sortable({items: ">li.row", axis: "y", containment: "parent", update: saveSortables});
     jQuery("#assignmentList div.widget").hide();
	  jQuery("#assignmentList li.row").hover(function(){ 
	  	 if (!jQuery("div.overlayMessage", this).get(0)) {
	     	jQuery("div.widget", this).show();
	     }
	  }, function() {
	     jQuery("div.widget", this).hide();
	  });
	  
	  jQuery(document).ready(function(){
			jQuery("input.delete_replace").each(function(){
				jQuery(this).hide();
				that = this;
				jQuery(this).prev("a.assignment_delete")[0].onclick = postFormAjax;
				jQuery(this).prev("a.assignment_delete").show();
			});
		});
		
		function postFormAjax() {
         var params = {};
         form = jQuery(this).parents("form:first").get(0);
         li = jQuery(this).parents("li.row:first").get(0);
         jQuery("input", form).each(function(){params[this.name] = this.value});
         jQuery.post(form.getAttribute("action") + "?call=ajax", params, function(xml) {
            body = xml.substring(xml.indexOf('<body'),
						xml.lastIndexOf('</body>') + 7);
            div = body.substring(body.indexOf('<div'),
                  body.lastIndexOf('</div>') + 6);
            jQuery(li).append('<div class="overlay"></div></div><div class="overlayMessage">' + div + '</div>');
            jQuery("div.overlay", li).css('opacity',.60);
            jQuery(".success", li).css('opacity',1);
            setTimeout(function(){  jQuery(li).fadeOut("slow"); }, 5000);
         });
		}
		
		function saveSortables() {
	     serialize = jQuery("#assignmentList").sortable("serialize", {attribute: "className"});
	     jQuery.ajax({
	        type: 'get',
	        url: ajaxCallbackURL,
	        data: serialize.replace(/\[\]/g, "").replace(/row\ /g,""),
	        success: function(a){
               //yay show confirmation
	        },
	        error: function(a) {
	        	return false;
	        }	        
	     });
	  }
		
      //]]>
	</script>
	
	</div>
</body>
</html>